---
    - debug: msg="Play_hosts={{ play_hosts }}"
      run_once: true
      tags: always

    - name: Get db2 instances
      shell: |
              DB2INST="{{ db2inst }}"
              if [[ "${DB2INST}" == "all" ]]; then
                /usr/local/bin/db2ls |  tail -n +4 | awk '{print $1}' |while read inst; do $inst/instance/db2ilist; done > /tmp/db2ilist.lst
              else
                echo "${DB2INST}" > /tmp/db2ilist.lst;
              fi
              cat /tmp/db2ilist.lst | grep -v db2cln
      register: db2ilist
      tags: always

    - name: Copy - Script to target node
      template: src="{{ scripttorun }}" dest="{{ logsdir }}/{{ scripttorun }}" mode=0755
      ignore_errors: true
      tags: copy

    - command: date +'%Y%m%d%H%M%S'
      register: timestamp 
    
    - set_fact:
        curtmstmp: "{{ timestamp.stdout }}"

    - name: "Run - Script - \"{{ scripttorun }}\""
      shell: |
             perl -p -i -e 's/\r//g' {{ logsdir }}/{{ script }}
             {{ logsdir }}/{{ script }} >> {{ logsdir }}/{{ script }}_out_{{ curtmstmp }}.txt
             chmod -f 777 {{ logsdir }}/{{ script }}_out_{{ curtmstmp }}.txt
      register: cmdout
      failed_when: cmdout.rc > 1
      become: true
      become_user: "{{ item }}"
      loop: "{{ db2ilist.stdout_lines }}"
      tags: run